{"ast":null,"code":"import _regeneratorRuntime from\"/Users/abhishektripathi/Documents/React_by_Brad/contact-keeper/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/abhishektripathi/Documents/React_by_Brad/contact-keeper/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/abhishektripathi/Documents/React_by_Brad/contact-keeper/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useReducer}from'react';import AuthContext from'../auth/authContext';import AuthReducer from'../auth/authReducer';import setAuthToken from'../../utils/setAuthToken';import axios from'axios';import{REGISTER_SUCCESS,REGISTER_FAIL,USER_LOADED,AUTH_ERROR,LOGIN_SUCCESS,LOGIN_FAIL,LOGOUT,CLEAR_ERRORS}from'../types';import{jsx as _jsx}from\"react/jsx-runtime\";var AuthState=function AuthState(props){var initialState={token:localStorage.getItem('token'),isAuthenticated:null,loading:true,user:null,error:null};var _useReducer=useReducer(AuthReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];//Load User\nvar loadUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0://Load token into global header\nif(localStorage.token){setAuthToken(localStorage.token);}_context.prev=1;_context.next=4;return axios.get('api/auth');case 4:res=_context.sent;dispatch({type:USER_LOADED,payload:res.data});_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);dispatch({type:AUTH_ERROR});case 11:case\"end\":return _context.stop();}}},_callee,null,[[1,8]]);}));return function loadUser(){return _ref.apply(this,arguments);};}();//Register User\nvar register=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(formData){var config,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:config={headers:{'Content-Type':'application/json'}};_context2.prev=1;_context2.next=4;return axios.post('/api/users',formData,config);case 4:res=_context2.sent;dispatch({type:REGISTER_SUCCESS,payload:res.data});loadUser();_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](1);dispatch({type:REGISTER_FAIL,payload:_context2.t0.response.data.msg});case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[1,9]]);}));return function register(_x){return _ref2.apply(this,arguments);};}();//Login User\nvar login=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(formData){var config,res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:config={headers:{'Content-Type':'application/json'}};_context3.prev=1;_context3.next=4;return axios.post('/api/auth',formData,config);case 4:res=_context3.sent;dispatch({type:LOGIN_SUCCESS,payload:res.data});loadUser();_context3.next=12;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](1);dispatch({type:LOGIN_FAIL,payload:_context3.t0.response.data.msg});case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[1,9]]);}));return function login(_x2){return _ref3.apply(this,arguments);};}();//Logout \nvar logout=function logout(){dispatch({type:LOGOUT});};//Clear Errors\nvar clearErrors=function clearErrors(){dispatch({type:CLEAR_ERRORS});};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{token:state.token,isAuthenticated:state.isAuthenticated,loading:state.loading,user:state.user,error:state.error,register:register,loadUser:loadUser,login:login,logout:logout,clearErrors:clearErrors},children:props.children});};export default AuthState;","map":{"version":3,"sources":["/Users/abhishektripathi/Documents/React_by_Brad/contact-keeper/client/src/context/auth/AuthState.js"],"names":["React","useReducer","AuthContext","AuthReducer","setAuthToken","axios","REGISTER_SUCCESS","REGISTER_FAIL","USER_LOADED","AUTH_ERROR","LOGIN_SUCCESS","LOGIN_FAIL","LOGOUT","CLEAR_ERRORS","AuthState","props","initialState","token","localStorage","getItem","isAuthenticated","loading","user","error","state","dispatch","loadUser","get","res","type","payload","data","register","formData","config","headers","post","response","msg","login","logout","clearErrors","children"],"mappings":"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","sourcesContent":["import React, { useReducer } from 'react';\nimport AuthContext from '../auth/authContext';\nimport AuthReducer from '../auth/authReducer';\nimport setAuthToken from '../../utils/setAuthToken';\nimport axios from 'axios';\nimport {\n    REGISTER_SUCCESS,\n    REGISTER_FAIL,\n    USER_LOADED,\n    AUTH_ERROR,\n    LOGIN_SUCCESS,\n    LOGIN_FAIL,\n    LOGOUT,\n    CLEAR_ERRORS\n} from '../types';\n\nconst AuthState = props => {\n    const initialState = {\n        token: localStorage.getItem('token'),\n        isAuthenticated: null,\n        loading: true,\n        user: null,\n        error: null\n    };\n\n    const [state, dispatch] = useReducer(AuthReducer, initialState);\n\n    //Load User\n    const loadUser = async () => {\n        //Load token into global header\n        if (localStorage.token) {\n            setAuthToken(localStorage.token)\n        }\n        try {\n            const res = await axios.get('api/auth');\n            dispatch({\n                type: USER_LOADED,\n                payload: res.data\n            })\n        }\n        catch (err) {\n            dispatch({\n                type: AUTH_ERROR\n            })\n        }\n    }\n    //Register User\n    const register = async formData => {\n        const config = {\n            headers: {\n                'Content-Type': 'application/json'\n            }\n        }\n        try {\n            const res = await axios.post('/api/users', formData, config);\n            dispatch({\n                type: REGISTER_SUCCESS,\n                payload: res.data\n            });\n            loadUser();\n        }\n        catch (err) {\n            dispatch({\n                type: REGISTER_FAIL,\n                payload: err.response.data.msg\n            })\n        }\n    }\n    //Login User\n    const login = async formData => {\n        const config = {\n            headers: {\n                'Content-Type': 'application/json'\n            }\n        }\n        try {\n            const res = await axios.post('/api/auth', formData, config);\n            dispatch({\n                type: LOGIN_SUCCESS,\n                payload: res.data\n            });\n            loadUser();\n        }\n        catch (err) {\n            dispatch({\n                type: LOGIN_FAIL,\n                payload: err.response.data.msg\n            })\n        }\n    }\n    //Logout \n    const logout = () => {\n        dispatch({\n            type: LOGOUT\n        }\n        )\n    }\n    //Clear Errors\n    const clearErrors = () => {\n        dispatch({\n            type: CLEAR_ERRORS\n        })\n    }\n\n    return (\n        <AuthContext.Provider\n            value={{\n                token: state.token,\n                isAuthenticated: state.isAuthenticated,\n                loading: state.loading,\n                user: state.user,\n                error: state.error,\n                register,\n                loadUser,\n                login,\n                logout,\n                clearErrors\n            }}>\n            {props.children}\n        </AuthContext.Provider>\n    )\n}\n\nexport default AuthState;"]},"metadata":{},"sourceType":"module"}